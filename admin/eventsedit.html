<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/datepicker/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" type="text/css" href="../css/datepicker/datedropper.css">
    <link rel="stylesheet" type="text/css" href="../css/datepicker/timedropper.min.css">
    <link rel="stylesheet" href="css/editormd.css"/>
    <link rel="shortcut icon" href="../images/xiyoulinux.png">
    <title>活动管理</title>
    <link href="css/sb-admin.css" rel="stylesheet">
    <link href="css/sb-bk-theme.css" rel="stylesheet">
    <link href="css/bk.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>

</head>
<body>

<div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" id="header">
        <script>
            $(function () {
                $("#header").load("header.html");
            })
        </script>
    </nav>


    <div id="page-wrapper">
        <div class="container-fluid">

            <!-- Page Heading -->
            <div class="row page-header-box" >
                <div class="col-lg-12">
                    <h1 class="page-header">
                        活动管理
                    </h1>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    编辑文章
                </div>

                <br/>
                <br/>
                <br/>

                <div class="container">
                    <form action="/admin/eventsedit" method="post" enctype="multipart/form-data" name="myform" onsubmit="return isPic(1)">
                            <input type="hidden" name="status" value="0">
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <span class="input-group-addon">标题：</span>
                                        <input type="text" class="form-control" name="title" placeholder="在此输入标题"
                                               value="aaaaaaaaaaa">
                                    </div>
                                </div>
                                <div class="col-xs-3">
                    <span style="margin: 0 auto;color: red;font-size: 20px;">qqqqqqqqqq</span>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="input-group ">
                                        <span class="input-group-addon">日期：</span>
                                        <input type="text" class="form-control" name="date" id="pickdate"
                                               placeholder="在此输入日期"
                                               value="aaaaaaaaaaaa">
                                    </div>
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <span class="input-group-addon">时间：</span>
                                        <input type="text" class="form-control" name="time" id="picktime"
                                               placeholder="在此输入时间"
                                               value="ssssssss">
                                    </div>
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <span class="input-group-addon">地点：</span>
                                        <input type="text" class="form-control" name="address" placeholder="在此输入地点"
                                               value="xian">
                                    </div>
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <span class="input-group-addon">标签：</span>
                                        <input type="text" class="form-control" name="label" placeholder="多个标签逗号隔开"
                                               value="sssssffdfd">
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="form-group">
                                        <div id="origin_poster">
                                            <span>已上传的活动海报:</span>
                                            <br/>
                                            <br/>
                                            <img src="https://www.baidu.com/img/bd_logo1.png" style="height: 200px">
                                        </div>
                                        <br/>
                                        <br/>
                                        <span>更改活动海报(小于5M):</span>
                                        <input type="file" id="inputfile" name="poster" onchange="isPic(1)">
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <textarea style="display: none" id="tmp"></textarea>
                            <div id="test-editormd">
                                <textarea style="display:none;width: 97%" id="text"></textarea>
                            </div>
                            <input type="hidden" name="markdown" id="markdown">
                            <input type="hidden" name="content" id="content">
                            <br/>
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <input type="submit" class="btn btn-success" value="提交" name="submit"
                                               onclick="getHtml()">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                <br/>
            </div>
        </div>
        <!-- /.container-fluid -->
    </div>
    <!-- /#page-wrapper -->
</div>


<!--editor-md 依赖 -->
<script src="js/jquery.min.js"></script>
<script src="js/editormd.min.js"></script>

<!--bootstrap依赖-->

<script src="js/bootstrap.min.js"></script>

<!--datepicter的依赖-->
<script type="text/javascript" charset="utf-8" src="../js/datepicker/datedropper.min.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/datepicker/timedropper.min.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/datepicker/datepicker.js"></script>


<script type="text/javascript">
    var testEditor;
    $(function () {
        testEditor = editormd("test-editormd", {
            width: "100%",
            height: 640,
            syncScrolling: "single",
            path: "../lib/",
            saveHTMLToTextarea: true,
            onfullscreen: function () {
                input = document.getElementsByClassName("form-control");
                for (var i = 0; i < input.length; i++) {
                    input[i].type = "hidden";
                }
                input = document.getElementsByName("submit");
                for (i = 0; i < input.length; i++) {
                    input[i].type = "hidden";
                }

            },
            onfullscreenExit: function () {
                input = document.getElementsByClassName("form-control");
                for (var i = 0; i < input.length; i++) {
                    input[i].type = "text";
                }
                input = document.getElementsByName("submit");
                for (i = 0; i < input.length; i++) {
                    input[i].type = "submit";
                }
            }
        });
    });

    function getHtml() {
        content = document.getElementById("content");
        content.value = testEditor.getHTML();
        md = document.getElementById("markdown");
        md.value = testEditor.getMarkdown();
    }
    function addContent() {
        content = document.getElementById("tmp");
        document.getElementById("text").value = content.value
    }
    onload = addContent();
</script>
<script type="text/javascript">
    function isPic(status) {
        var fileSize = 0;
        var filetypes = ["jpg", "png", "gif", "JPG", "PNG", "GIF"];
        var filepath = myform.poster.value;
        var filemaxsize = 1024 * 5;     //5M
        if (filepath) {
            var isnext = false;
            var fileend = filepath;
            while (true) {
                if (fileend.indexOf('.') < 0) {
                    break;
                }
                fileend = fileend.substring(fileend.indexOf('.') + 1);
            }

            if (filetypes && filetypes.length > 0) {
                for (var i = 0; i < filetypes.length; i++) {
                    if (filetypes[i] == fileend) {
                        isnext = true;
                        break;
                    }
                }
            }
            if (!isnext) {
                alert("只能上传jpg,png,gif文件！");
                myform.poster.value = "";
                return false;
            }
        } else {
            if (status == 1) {
                return true;
            } else {
                alert("活动海报不能为空！");
                alert(status);
                return false;
            }
        }
        if (!myform.poster.files) {
            var filePath = myform.poster.value;
            var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
            if (!fileSystem.FileExists(filePath)) {
                alert("图片不存在，请重新输入！");
                return false;
            }
            var file = fileSystem.GetFile(filePath);
            fileSize = file.Size;
        } else {
            fileSize = myform.poster.files[0].size;
        }

        var size = fileSize / 1024;


        if (size > filemaxsize) {
            alert("图片大小不能大于" + filemaxsize / 1024 + "M！");
            myform.poster.value = "";
            return false;
        } else if (size <= 0) {
            alert("图片大小不能为0M！");
            myform.poster.value = "";
            return false;
        } else {
            $("#origin_poster").hide();
            return true;
        }
    }
</script>

</body>
</html>